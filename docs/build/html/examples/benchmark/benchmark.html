

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pairtools benchmarking &mdash; nf-rnachrom 1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=29a6c3e3"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            nf-rnachrom
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Overview</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html#setup-and-installation">Setup and Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration.html">Configuration</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nf-rnachrom</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Pairtools benchmarking</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/examples/benchmark/benchmark.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Pairtools-benchmarking">
<h1>Pairtools benchmarking<a class="headerlink" href="#Pairtools-benchmarking" title="Link to this heading"></a></h1>
<p>Welcome to pairtools benchmarking. These are the instructions on how to test performance of different software for mapping Hi-C and Hi-C-like methods. Mapping usually results in the file with mapped pairs, which is then converted into binned matrix format. Pairs format is the “rawest” interpretable type of data after reads.</p>
<p>Reviewing the literature suggests that there are at least 6 methods to map Hi-C and Hi-C-like data. These include:</p>
<ul>
<li><p><strong>pairtools</strong> is a lightweight Python CLI that extracts and manipulates Hi-C contacts post-alignment. Aslignment can be done by:</p>
<ul class="simple">
<li><p>bwa mem</p></li>
<li><p>bwa-mem2, ahn optimized version of bwa mem, which <a class="reference external" href="https://github.com/bwa-mem2/bwa-mem2">x2-2.5 improves speed over bwa</a></p></li>
</ul>
</li>
<li><p><strong>chromap</strong> is a <a class="reference external" href="https://www.nature.com/articles/s41467-021-26865-w">fast alignment tool for chromatin profiles</a>, not specialized for Hi-C but <a class="reference external" href="https://github.com/haowenz/chromap#map-hi-c-short-reads">parameterized for a broad range of sequencing data including Hi-C short reads</a>.</p>
<p>Does not require separate step of mapping.</p>
</li>
<li><p><strong>HiC-Pro</strong> is a <a class="reference external" href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-015-0831-x">pipeline for Hi-C and DNase-C mapping</a>, “optimized and flexible”.</p>
<p>It calls mapping within. By default, creates the output cooler files with binned data, but the script can be tinkered in order to stop the processing at the step of pairs.</p>
</li>
<li><p><strong>Juicer</strong> is a <a class="reference external" href="https://github.com/aidenlab/juicer">platform for analysis of Hi-C data</a>, which is already adapted to a wide range of cluster types.</p>
<p>It calls mapping within. Has an option to stop the data processing at the step of pairs, without further construction of binned matrices.</p>
</li>
<li><p><strong>HiCExplorer</strong> is a <a class="reference external" href="https://doi.org/10.1038/s41467-017-02525-w">broad-range set of tools for processing, normalization, analysis and visualization Hi-C and Hi-C-like methods</a>.</p>
<p>It <a class="reference external" href="https://hicexplorer.readthedocs.io/en/latest/content/tools/hicBuildMatrix.html#hicbuildmatrix">builds Hi-C binned matrix post-alignment with bwa mem</a>.</p>
</li>
<li><p><strong>FAN-C</strong> is a <a class="reference external" href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-020-02215-9">set of CLI tools that runs the mapping (bowtie or bwa mem), extracts and manipulates Hi-C contacts</a>. It also has the <a class="reference external" href="https://github.com/vaquerizaslab/fanc">tools for data visualization and downstream analysis</a>.</p></li>
<li><p><strong>TADbit</strong> is <a class="reference external" href="https://3dgenomes.github.io/TADbit/index.html">multi-task Python API</a> that handles all the steps from the alignment of paired-end reads to the detection of Topologically Associating Domain (TAD) borders, compartments and three-dimensional modeling of chromatin based on interaction matrices.</p></li>
</ul>
<p><em>We benchmark these programs on one million of representative reads.</em> These reads are taken from random replicate from Rao SSP et al., <a class="reference external" href="https://pubmed.ncbi.nlm.nih.gov/28985562/">“Cohesin Loss Eliminates All Loop Domains.”</a>, Cell, 2017 Oct 5;171(2):305-320.e24 Generally, it is useful to assess how much computational time you need per million of reads. As long as you have this assessment, you may multiply the size of your experiment by the whole library size (in mlns of reads), because we
expect linear growth of computational complexity of reads mapping with library size.</p>
<p>The benchmarking consists of four general steps. If you want to reproduce it, you need to run steps 1 and 2 manually in order to create the working environment, and then use snakemake script to run the benchmarks. You may use the commands form the “3. Run” section to get an understanding how each indiviaul framework works and what parameters can be changed. Note that you need separate run of juicer with single value of –ncores, because it does not support parallel launches (because it writes to
the default output). Finally, there is a visualization section with a display of all the results that we calcualted on our machines.</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#1.-Install-software"><span class="std std-ref">Install software</span></a></p></li>
<li><p><a class="reference internal" href="#2.-Download-data-and-genome"><span class="std std-ref">Download data and genome</span></a>.</p></li>
<li><p><a class="reference internal" href="#3.-Run"><span class="std std-ref">Run</span></a></p></li>
<li><p><a class="reference internal" href="#4.-Visualize-benchmarks"><span class="std std-ref">Visualize benchmarks</span></a></p></li>
</ol>
<section id="1.-Install-software">
<h2>1. Install software<a class="headerlink" href="#1.-Install-software" title="Link to this heading"></a></h2>
<p>We will use separate conda environments to install different utilities. Each utility will have its own environment and peth to the binaries.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
mkdir<span class="w"> </span>./soft
</pre></div>
</div>
</div>
<section id="pairtools">
<h3>pairtools<a class="headerlink" href="#pairtools" title="Link to this heading"></a></h3>
<section id="pairtools-v1.0.2">
<h4>pairtools v1.0.2<a class="headerlink" href="#pairtools-v1.0.2" title="Link to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
conda<span class="w"> </span>create<span class="w"> </span>-y<span class="w"> </span>--prefix<span class="w"> </span>soft/pairtools1.0.2<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.9<span class="w"> </span>pip
conda<span class="w"> </span>activate<span class="w"> </span>soft/pairtools1.0.2
pip<span class="w"> </span>install<span class="w"> </span>cython<span class="w"> </span>numpy<span class="w"> </span>pysam
pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/open2c/pairtools.git@v1.0.2

conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>lz4-c<span class="w"> </span><span class="c1"># conda install -c anaconda lz4</span>

conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-c<span class="w"> </span>bioconda<span class="w"> </span><span class="s2">&quot;bwa&gt;=0.7.17&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="bwa-mem2">
<h4>bwa-mem2<a class="headerlink" href="#bwa-mem2" title="Link to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
conda<span class="w"> </span>activate<span class="w"> </span>soft/pairtools1.0.2

<span class="c1"># bwa-mem2: compile from source (not recommended for general users)</span>

<span class="c1"># Get the source</span>
git<span class="w"> </span>clone<span class="w"> </span>--recursive<span class="w"> </span>https://github.com/bwa-mem2/bwa-mem2<span class="w"> </span>soft/bwa-mem2
<span class="nb">cd</span><span class="w"> </span>soft/bwa-mem2

<span class="c1"># Compile</span>
make

<span class="c1"># Exit compilation folder</span>
<span class="nb">cd</span><span class="w"> </span>../../
</pre></div>
</div>
</div>
</section>
</section>
<section id="chromap">
<h3>chromap<a class="headerlink" href="#chromap" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
conda<span class="w"> </span>create<span class="w"> </span>-y<span class="w"> </span>--prefix<span class="w"> </span>soft/chromap
conda<span class="w"> </span>activate<span class="w"> </span>soft/chromap
conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-c<span class="w"> </span>bioconda<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>chromap
</pre></div>
</div>
</div>
</section>
<section id="HiC-Pro">
<h3>HiC-Pro<a class="headerlink" href="#HiC-Pro" title="Link to this heading"></a></h3>
<p><a class="reference external" href="https://github.com/nservant/HiC-Pro">HiC-Pro</a> is a popular software for Hi-C mapping, its now part of nf-core Hi-C pipeline, supports both fragment-based analysis of Hi-C and fragement-free analysis of DNase-based Hi-C.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/nservant/HiC-Pro.git<span class="w"> </span>soft/HiC-Pro_env/HiC-Pro
conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>soft/HiC-Pro_env/HiC-Pro/environment.yml<span class="w"> </span>-p<span class="w"> </span>soft/HiC-Pro_env
<span class="c1">### Working environment will be soft/HiC-Pro_env</span>

conda<span class="w"> </span>activate<span class="w"> </span>soft/HiC-Pro_env

<span class="c1"># Install dependencies</span>
conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-c<span class="w"> </span>bioconda<span class="w"> </span>bowtie2<span class="w"> </span>samtools<span class="w"> </span>pysam<span class="w"> </span>numpy<span class="w"> </span>scipy<span class="w"> </span>bx-python
conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-c<span class="w"> </span>r<span class="w"> </span>r<span class="w"> </span>r-rcolorbrewer<span class="w"> </span>r-ggplot2

<span class="c1"># Copy prepared config:</span>
cp<span class="w"> </span>configs/config-hicpro_install.txt<span class="w"> </span>soft/HiC-Pro_env/HiC-Pro/config-install.txt
cp<span class="w"> </span>configs/config-hicpro.txt<span class="w"> </span>soft/HiC-Pro_env/HiC-Pro/config-hicpro.txt

<span class="c1"># Configure and install:</span>
<span class="nb">cd</span><span class="w"> </span>soft/HiC-Pro_env/HiC-Pro
make<span class="w"> </span>configure
make<span class="w"> </span>install

<span class="nb">cd</span><span class="w"> </span>../../../

<span class="c1"># Patch the code to retain only data processing steps with no creating of maps:</span>
sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s/all : init mapping proc_hic merge_persample hic_qc build_raw_maps ice_norm/all : init mapping proc_hic merge_persample #hic_qc build_raw_maps ice_norm/&quot;</span><span class="w"> </span>soft/HiC-Pro_env/HiC-Pro/scripts/Makefile
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
<span class="c1"># Note that the configs should be adjusted for your system:</span>
cp<span class="w"> </span>configs/config-hicpro_install.txt<span class="w"> </span>soft/HiC-Pro_env/HiC-Pro/config-install.txt
cp<span class="w"> </span>configs/config-hicpro.txt<span class="w"> </span>soft/HiC-Pro_env/HiC-Pro/config-hicpro.txt
</pre></div>
</div>
</div>
</section>
<section id="FAN-C">
<h3>FAN-C<a class="headerlink" href="#FAN-C" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
conda<span class="w"> </span>create<span class="w"> </span>-y<span class="w"> </span>--prefix<span class="w"> </span>soft/fanc<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.9<span class="w"> </span>pip<span class="w"> </span>hdf5
conda<span class="w"> </span>activate<span class="w"> </span>soft/fanc
pip<span class="w"> </span>install<span class="w"> </span>fanc
conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-c<span class="w"> </span>bioconda<span class="w"> </span>samtools
</pre></div>
</div>
</div>
</section>
<section id="Juicer">
<h3>Juicer<a class="headerlink" href="#Juicer" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

conda<span class="w"> </span>create<span class="w"> </span>-y<span class="w"> </span>--prefix<span class="w"> </span>soft/juicer
conda<span class="w"> </span>activate<span class="w"> </span>soft/juicer

conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-c<span class="w"> </span>bioconda<span class="w"> </span>bwa<span class="w"> </span>java-jdk
conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>coreutils

<span class="c1"># Download the recommended stable version:</span>
wget<span class="w"> </span>https://github.com/aidenlab/juicer/archive/refs/tags/1.6.zip
unzip<span class="w"> </span><span class="m">1</span>.6.zip
rm<span class="w"> </span><span class="m">1</span>.6.zip
mv<span class="w"> </span>juicer-1.6<span class="w"> </span>soft/juicer-1.6

<span class="c1"># Download compile jar files of the stable  version:</span>
wget<span class="w"> </span>http://hicfiles.tc4ga.com.s3.amazonaws.com/public/juicer/juicer_tools.1.6.2_jcuda.0.7.5.jar
mv<span class="w"> </span>juicer_tools.1.6.2_jcuda.0.7.5.jar<span class="w"> </span>soft/juicer-1.6/CPU/scripts/common/juicer_tools.jar

<span class="c1"># Copy the scripts to some accessible location:</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>soft/juicer-1.6/CPU/scripts/
cp<span class="w"> </span>-r<span class="w"> </span>soft/juicer-1.6/CPU/<span class="o">[</span>^s<span class="o">]</span>*<span class="w"> </span>soft/juicer-1.6/CPU/scripts/
</pre></div>
</div>
</div>
</section>
<section id="HiCExplorer">
<h3>HiCExplorer<a class="headerlink" href="#HiCExplorer" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

conda<span class="w"> </span>create<span class="w"> </span>-y<span class="w"> </span>--prefix<span class="w"> </span>soft/hicexplorer<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.9
conda<span class="w"> </span>activate<span class="w"> </span>soft/hicexplorer
conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-c<span class="w"> </span>bioconda<span class="w"> </span>hicexplorer<span class="w"> </span>bwa
</pre></div>
</div>
</div>
</section>
<section id="TADbit">
<h3>TADbit<a class="headerlink" href="#TADbit" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

conda<span class="w"> </span>create<span class="w"> </span>-y<span class="w"> </span>--prefix<span class="w"> </span>soft/tadbit
conda<span class="w"> </span>activate<span class="w"> </span>soft/tadbit

<span class="c1"># # Install mappers:</span>
conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-q<span class="w"> </span>-c<span class="w"> </span>bioconda<span class="w"> </span>gem3-mapper<span class="w"> </span>bowtie2

<span class="c1"># install tadbit</span>
conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-q<span class="w"> </span>-c<span class="w"> </span>bioconda<span class="w"> </span>tadbit
</pre></div>
</div>
</div>
</section>
</section>
<section id="2.-Download-data-and-genome">
<h2>2. Download data and genome<a class="headerlink" href="#2.-Download-data-and-genome" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

mkdir<span class="w"> </span>data
</pre></div>
</div>
</div>
<section id="Download-raw-data">
<h3>Download raw data<a class="headerlink" href="#Download-raw-data" title="Link to this heading"></a></h3>
<p>Test data from Rao et al. 2017, 1 mln pairs:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

fastq-dump<span class="w"> </span>-O<span class="w"> </span>data<span class="w"> </span>--gzip<span class="w"> </span>--split-files<span class="w"> </span>SRR6107789<span class="w"> </span>--minSpotId<span class="w"> </span><span class="m">0</span><span class="w"> </span>--maxSpotId<span class="w"> </span><span class="m">1000000</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

<span class="c1"># Put the data in accessible folder for juicer:</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>data/4juicer/fastq/
mkdir<span class="w"> </span>-p<span class="w"> </span>data/4juicer/splits/
cp<span class="w"> </span>data/SRR6107789_1.fastq.gz<span class="w"> </span>data/4juicer/fastq/SRR6107789_R1.fastq.gz
cp<span class="w"> </span>data/SRR6107789_2.fastq.gz<span class="w"> </span>data/4juicer/fastq/SRR6107789_R2.fastq.gz
cp<span class="w"> </span>data/4juicer/fastq/*<span class="w"> </span>data/4juicer/splits/
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

<span class="c1"># Put the data in accessible folder for HiC-Pro:</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>soft/HiC-Pro_env/HiC-Pro/rawdata/sample1
cp<span class="w"> </span>data/S*fastq.gz<span class="w"> </span>soft/HiC-Pro_env/HiC-Pro/rawdata/sample1/
</pre></div>
</div>
</div>
</section>
<section id="Install-genome">
<h3>Install genome<a class="headerlink" href="#Install-genome" title="Link to this heading"></a></h3>
<section id="Genomepy-installation">
<h4>Genomepy installation<a class="headerlink" href="#Genomepy-installation" title="Link to this heading"></a></h4>
<p>will install fasta, bwa and bowtie2 indexes:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

<span class="c1"># Activate bwa plugin for genomepy:</span>
!<span class="w"> </span>genomepy<span class="w"> </span>plugin<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>bwa<span class="w"> </span>bowtie2
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

<span class="c1"># Install hg38 genome by genomepy:</span>
!<span class="w"> </span>genomepy<span class="w"> </span>install<span class="w"> </span>hg38<span class="w"> </span>-g<span class="w"> </span>data/
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

<span class="c1"># Restrict the genome:</span>
!<span class="w"> </span>cooler<span class="w"> </span>digest<span class="w"> </span>data/hg38/hg38.fa.sizes<span class="w"> </span>data/hg38/hg38.fa<span class="w"> </span>DpnII<span class="w"> </span>--rel-ids<span class="w"> </span><span class="m">1</span><span class="w"> </span>-o<span class="w"> </span>data/hg38/hg38.DpnII.bed
</pre></div>
</div>
</div>
</section>
<section id="Build-genome-index:-bwa-mem2">
<h4>Build genome index: bwa-mem2<a class="headerlink" href="#Build-genome-index:-bwa-mem2" title="Link to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
mkdir<span class="w"> </span>data/hg38/index/bwa-mem2/
soft/bwa-mem2/bwa-mem2<span class="w"> </span>index<span class="w"> </span>-p<span class="w"> </span>data/hg38/index/bwa-mem2/hg38<span class="w"> </span>data/hg38/hg38.fa
</pre></div>
</div>
</div>
</section>
<section id="Build-genome-index:-chromap">
<h4>Build genome index: chromap<a class="headerlink" href="#Build-genome-index:-chromap" title="Link to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
mkdir<span class="w"> </span>data/hg38/index/chromap
chromap<span class="w"> </span>-i<span class="w"> </span>-r<span class="w"> </span>data/hg38/hg38.fa<span class="w"> </span>-o<span class="w"> </span>data/hg38/index/chromap/hg38
</pre></div>
</div>
</div>
</section>
<section id="Build-genome-index:-GEM">
<h4>Build genome index: GEM<a class="headerlink" href="#Build-genome-index:-GEM" title="Link to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash
mkdir<span class="w"> </span>data/hg38/index/gem
gem-indexer<span class="w"> </span>-T<span class="w"> </span><span class="m">8</span><span class="w"> </span>-i<span class="w"> </span>data/hg38/hg38.fa<span class="w"> </span>-o<span class="w"> </span>data/hg38/index/gem/hg38
</pre></div>
</div>
</div>
</section>
</section>
</section>
<section id="3.-Run">
<h2>3. Run<a class="headerlink" href="#3.-Run" title="Link to this heading"></a></h2>
<p>The banchmarking is usually cumbersome, but it can be simplified by snakemake. We provide a Snakemake pipeline that will allow you to benchmark different approaches.</p>
<p>The output of snakemake will consist of resulting Hi-C pairs/maps in <code class="docutils literal notranslate"><span class="pre">output</span></code> folder and benchmarking files in <code class="docutils literal notranslate"><span class="pre">benchmarks</span></code> folder. The file names have the information on parameters in their names:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

<span class="c1"># Running</span>
snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">10</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

<span class="c1"># Cleanup (only if you want to erase all the output)</span>
rm<span class="w"> </span>output/*<span class="p">;</span><span class="w"> </span>rm<span class="w"> </span>benchmarks/*
</pre></div>
</div>
</div>
</section>
<section id="Manual-run">
<h2>Manual run<a class="headerlink" href="#Manual-run" title="Link to this heading"></a></h2>
<p>You may also run them to test individual steps of the pipeline.</p>
<section id="id1">
<h3>pairtools<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

soft/bwa-mem2/bwa-mem2<span class="w"> </span>mem<span class="w"> </span>-t<span class="w"> </span><span class="m">5</span><span class="w"> </span>-SP<span class="w"> </span>data/hg38/index/bwa-mem2/hg38<span class="w"> </span>data/SRR6107789_1.fastq.gz<span class="w"> </span>data/SRR6107789_2.fastq.gz<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>soft/pairtools1.0.2/bin/pairtools<span class="w"> </span>parse<span class="w"> </span>--nproc-in<span class="w"> </span><span class="m">5</span><span class="w"> </span>--nproc-out<span class="w"> </span><span class="m">5</span><span class="w"> </span>--drop-sam<span class="w"> </span>--drop-seq<span class="w"> </span>-c<span class="w"> </span>data/hg38/hg38.fa.sizes<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>soft/pairtools1.0.2/bin/pairtools<span class="w"> </span>sort<span class="w"> </span>--nproc<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>soft/pairtools1.0.2/bin/pairtools<span class="w"> </span>dedup<span class="w"> </span>-p<span class="w"> </span><span class="m">5</span><span class="w"> </span>--backend<span class="w"> </span>cython<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-o<span class="w"> </span>output/result.pairtools.pairs
</pre></div>
</div>
</div>
</section>
<section id="id2">
<h3>chromap<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

soft/chromap/bin/chromap<span class="w"> </span>--preset<span class="w"> </span>hic<span class="w"> </span>--low-mem<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-t<span class="w"> </span><span class="m">5</span><span class="w"> </span>-x<span class="w"> </span>data/hg38/index/chromap/hg38<span class="w"> </span>-r<span class="w"> </span>data/hg38/hg38.fa<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-1<span class="w"> </span>data/SRR6107789_1.fastq.gz<span class="w"> </span>-2<span class="w"> </span>data/SRR6107789_2.fastq.gz<span class="w"> </span>-o<span class="w"> </span>output/result.chromap.pairs
</pre></div>
</div>
</div>
</section>
<section id="id3">
<h3>HiC-Pro<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

<span class="nb">cd</span><span class="w"> </span>soft/HiC-Pro_env/HiC-Pro
bin/HiC-Pro<span class="w"> </span>-i<span class="w"> </span>rawdata/<span class="w"> </span>-o<span class="w"> </span>output<span class="w"> </span>-c<span class="w"> </span>config-hicpro.txt

<span class="nb">cd</span><span class="w"> </span>../../../
</pre></div>
</div>
</div>
</section>
<section id="id4">
<h3>FAN-C<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p>Based on <a class="reference external" href="https://fan-c.readthedocs.io/en/latest/fanc-executable/fanc-generate-hic/fanc_modular_steps.html">CLI tutorial</a>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

fanc<span class="w"> </span>map<span class="w"> </span>-t<span class="w"> </span><span class="m">5</span><span class="w"> </span>data/SRR6107789_1.fastq.gz<span class="w"> </span>data/hg38/index/bwa/hg38.fa<span class="w"> </span>output/fanc-output_1.bam
fanc<span class="w"> </span>map<span class="w"> </span>-t<span class="w"> </span><span class="m">5</span><span class="w"> </span>data/SRR6107789_2.fastq.gz<span class="w"> </span>data/hg38/index/bwa/hg38.fa<span class="w"> </span>output/fanc-output_2.bam
samtools<span class="w"> </span>sort<span class="w"> </span>-@<span class="w"> </span><span class="m">5</span><span class="w"> </span>-n<span class="w"> </span>output/fanc-output_1.bam<span class="w"> </span>-o<span class="w"> </span>output/fanc-output_1.sorted.bam
samtools<span class="w"> </span>sort<span class="w"> </span>-@<span class="w"> </span><span class="m">5</span><span class="w"> </span>-n<span class="w"> </span>output/fanc-output_2.bam<span class="w"> </span>-o<span class="w"> </span>output/fanc-output_2.sorted.bam
fanc<span class="w"> </span>pairs<span class="w"> </span>output/fanc-output_1.sorted.bam<span class="w"> </span>output/fanc-output_2.sorted.bam<span class="w"> </span>output/fanc-output.pairs<span class="w"> </span>-g<span class="w"> </span>data/hg38/hg38.DpnII.bed
</pre></div>
</div>
</div>
</section>
<section id="id5">
<h3>Juicer<a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

soft/juicer-1.6/CPU/juicer.sh<span class="w"> </span>-g<span class="w"> </span>hg38<span class="w"> </span>-d<span class="w"> </span>data/4juicer/<span class="w"> </span>-s<span class="w"> </span>DpnII<span class="w"> </span>-S<span class="w"> </span>early<span class="w"> </span>-p<span class="w"> </span>data/hg38/hg38.fa.sizes<span class="w"> </span>-y<span class="w"> </span>data/hg38/hg38.DpnII.bed<span class="w"> </span>-z<span class="w"> </span>data/hg38/index/bwa/hg38.fa<span class="w"> </span>-t<span class="w"> </span><span class="m">5</span><span class="w"> </span>-D<span class="w"> </span>soft/juicer-1.6/CPU
<br/></pre></div>
</div>
</div>
</section>
<section id="id6">
<h3>HiCExplorer<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<p>Based on the example: <a class="reference external" href="https://hicexplorer.readthedocs.io/en/latest/content/example_usage.html">https://hicexplorer.readthedocs.io/en/latest/content/example_usage.html</a></p>
<p>Note that it does not procude the pairs, but binned coolers.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

hicBuildMatrix<span class="w"> </span>--samFiles<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&lt;<span class="o">(</span>bwa<span class="w"> </span>mem<span class="w"> </span>-t<span class="w"> </span><span class="m">4</span><span class="w"> </span>-A1<span class="w"> </span>-B4<span class="w"> </span>-E50<span class="w"> </span>-L0<span class="w"> </span>data/hg38/index/bwa/hg38.fa<span class="w"> </span>data/SRR6107789_1.fastq.gz<span class="w"> </span><span class="p">|</span><span class="w"> </span>samtools<span class="w"> </span>view<span class="w"> </span>-Shb<span class="w"> </span>-<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>&lt;<span class="o">(</span>bwa<span class="w"> </span>mem<span class="w"> </span>-t<span class="w"> </span><span class="m">4</span><span class="w"> </span>-A1<span class="w"> </span>-B4<span class="w"> </span>-E50<span class="w"> </span>-L0<span class="w"> </span>data/hg38/index/bwa/hg38.fa<span class="w"> </span>data/SRR6107789_2.fastq.gz<span class="w"> </span><span class="p">|</span><span class="w"> </span>samtools<span class="w"> </span>view<span class="w"> </span>-Shb<span class="w"> </span>-<span class="o">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--restrictionSequence<span class="w"> </span>GATC<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--danglingSequence<span class="w"> </span>GATC<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--restrictionCutFile<span class="w"> </span>data/hg38/hg38.DpnII.bed<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--threads<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--inputBufferSize<span class="w"> </span><span class="m">100000</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--QCfolder<span class="w"> </span>hicexplorer_tmp<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-o<span class="w"> </span>hicexplorer_output.cool
</pre></div>
</div>
</div>
</section>
<section id="id7">
<h3>TADbit<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

tadbit<span class="w"> </span>map<span class="w"> </span>tadbit_output<span class="w"> </span>--fastq<span class="w"> </span>data/SRR6107789_1.fastq.gz<span class="w"> </span>--read<span class="w"> </span><span class="m">1</span><span class="w"> </span>--index<span class="w"> </span>data/hg38/index/gem/hg38.gem<span class="w"> </span>--renz<span class="w"> </span>DpnII
tadbit<span class="w"> </span>map<span class="w"> </span>tadbit_output<span class="w"> </span>--fastq<span class="w"> </span>data/SRR6107789_2.fastq.gz<span class="w"> </span>--read<span class="w"> </span><span class="m">2</span><span class="w"> </span>--index<span class="w"> </span>data/hg38/index/gem/hg38.gem<span class="w"> </span>--renz<span class="w"> </span>DpnII

tadbit<span class="w"> </span>parse<span class="w"> </span>tadbit_output<span class="w"> </span>--genome<span class="w"> </span>data/hg38/hg38.fa

tadbit<span class="w"> </span>filter<span class="w"> </span>tadbit_output<span class="w"> </span>--format<span class="w"> </span>short
</pre></div>
</div>
</div>
</section>
<section id="Read-mapping-only">
<h3>Read mapping only<a class="headerlink" href="#Read-mapping-only" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-bash notranslate"><div class="highlight"><pre><span></span>%%bash

<span class="c1"># bwa mem</span>
soft/pairtools0.3.0/bin/bwa<span class="w"> </span>mem<span class="w"> </span>-t<span class="w"> </span><span class="m">4</span><span class="w"> </span>-SP<span class="w"> </span>data/hg38/index/bwa/hg38.fa<span class="w"> </span>data/SRR6107789_1.fastq.gz<span class="w"> </span>data/SRR6107789_2.fastq.gz<span class="w"> </span>&gt;<span class="w"> </span>bwa-mem.sam

<span class="c1"># bwa mem2</span>
soft/bwa-mem2/bwa-mem2<span class="w"> </span>mem<span class="w"> </span>-t<span class="w"> </span><span class="m">4</span><span class="w"> </span>-SP<span class="w"> </span>data/hg38/index/bwa-mem2/hg38<span class="w"> </span>data/SRR6107789_1.fastq.gz<span class="w"> </span>data/SRR6107789_2.fastq.gz<span class="w"> </span>&gt;<span class="w"> </span>bwa-mem2.sam

<span class="c1"># bowtie2 only</span>
soft/tadbit/bin/bowtie2<span class="w"> </span>-p<span class="w"> </span><span class="m">4</span><span class="w"> </span>-x<span class="w"> </span>data/hg38/index/bowtie2/hg38<span class="w"> </span>-1<span class="w"> </span>data/SRR6107789_1.fastq.gz<span class="w"> </span>-2<span class="w"> </span>data/SRR6107789_2.fastq.gz<span class="w"> </span>-S<span class="w"> </span>bowtie2.sam
<br/></pre></div>
</div>
</div>
</section>
</section>
<section id="4.-Visualize-benchmarks">
<h2>4. Visualize benchmarks<a class="headerlink" href="#4.-Visualize-benchmarks" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the CPU properties:</span>
<span class="kn">import</span> <span class="nn">psutil</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span><span class="si">}</span><span class="s2"> CPUs at </span><span class="si">{</span><span class="n">psutil</span><span class="o">.</span><span class="n">cpu_freq</span><span class="p">()</span><span class="o">.</span><span class="n">current</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> GHz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
36 CPUs at 1211 GHz
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sans-serif&quot;</span>
<span class="n">figsize_A4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">11.69</span><span class="p">,</span> <span class="mf">8.27</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">figsize_A4</span><span class="o">.</span><span class="n">T</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.facecolor&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;white&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">16</span>

<span class="kn">import</span> <span class="nn">glob</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## If you start from .csv. file:</span>
<span class="c1"># df = pd.read_csv(&#39;benchmarking_1mln.csv&#39;)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If you start from your own benchmarks:</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;benchmarks/*&quot;</span><span class="p">)</span> <span class="c1">#+ glob.glob(&quot;benchmarks_v1_2022/*&quot;)# +</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
39
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">split</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">util</span><span class="o">=</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ncores</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">util</span><span class="p">,</span> <span class="n">ncores</span>

<span class="n">timings</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">t</span><span class="p">[[</span><span class="s1">&#39;util&#39;</span><span class="p">,</span> <span class="s1">&#39;ncores&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">timings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">timings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">timings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">timings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>s</th>
      <th>h:m:s</th>
      <th>max_rss</th>
      <th>max_vms</th>
      <th>max_uss</th>
      <th>max_pss</th>
      <th>io_in</th>
      <th>io_out</th>
      <th>mean_load</th>
      <th>cpu_time</th>
      <th>util</th>
      <th>ncores</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>482.1029</td>
      <td>0:08:02</td>
      <td>17068.97</td>
      <td>20572.73</td>
      <td>16931.91</td>
      <td>16951.71</td>
      <td>16275.21</td>
      <td>0.02</td>
      <td>102.18</td>
      <td>493.82</td>
      <td>pairtools_bwamem2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>482.5261</td>
      <td>0:08:02</td>
      <td>17079.46</td>
      <td>20508.73</td>
      <td>16941.46</td>
      <td>16956.34</td>
      <td>32534.11</td>
      <td>39.25</td>
      <td>101.73</td>
      <td>498.88</td>
      <td>pairtools_bwamem2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>488.9997</td>
      <td>0:08:08</td>
      <td>17055.04</td>
      <td>20508.59</td>
      <td>16920.96</td>
      <td>16939.69</td>
      <td>42104.61</td>
      <td>78.47</td>
      <td>100.17</td>
      <td>502.58</td>
      <td>pairtools_bwamem2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>484.3460</td>
      <td>0:08:04</td>
      <td>16981.59</td>
      <td>20380.60</td>
      <td>16961.30</td>
      <td>16962.37</td>
      <td>45493.36</td>
      <td>117.70</td>
      <td>93.06</td>
      <td>50.54</td>
      <td>pairtools_bwamem2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>483.3159</td>
      <td>0:08:03</td>
      <td>16969.02</td>
      <td>20595.51</td>
      <td>16944.75</td>
      <td>16945.79</td>
      <td>61922.79</td>
      <td>156.93</td>
      <td>99.61</td>
      <td>507.64</td>
      <td>pairtools_bwamem2</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[87]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">timings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;ncores&#39;</span><span class="p">,</span> <span class="s1">&#39;util&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[88]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;benchmarking_1mln.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">util</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;bowtie&#39;, &#39;bwamem&#39;, &#39;bwamem2&#39;, &#39;chromap&#39;, &#39;fanc_bowtie2&#39;,
       &#39;fanc_bwa&#39;, &#39;hicexplorer&#39;, &#39;hicpro&#39;, &#39;juicer&#39;, &#39;pairtools&#39;,
       &#39;pairtools_bwamem2&#39;, &#39;tadbit&#39;, &#39;tadbit_bowtie2&#39;], dtype=object)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;chromap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pairtools_bwamem2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tadbit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pairtools&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tadbit_bowtie2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;juicer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hicpro&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hicexplorer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fanc_bwa&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fanc_bowtie2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bwamem2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bwamem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bowtie&#39;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">labels_mod</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Chromap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bwa-mem2 + pairtools&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GEM + TADbit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bwa mem + pairtools&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bowtie2 + TADbit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Juicer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Hi-Pro&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HiCExplorer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bwa mem + FANC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bowtie2 + FANC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bwa-mem2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bwa mem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bowtie2&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#FD7F69&#39;</span><span class="p">,</span> <span class="s1">&#39;#9FC9DD&#39;</span><span class="p">,</span> <span class="s1">&#39;#89A76F&#39;</span><span class="p">]</span>

<span class="n">style_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>
        <span class="n">palette</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">errwidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mf">0.07</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;util&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">),</span>
        <span class="n">order</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;ncores&#39;</span><span class="p">,</span>
        <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">style_dict</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">patches</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (sec)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels_mod</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1">#ax.set_xscale(&#39;log&#39;)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5e3</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6000</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;max_rss&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;util&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">),</span>
        <span class="n">order</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;ncores&#39;</span><span class="p">,</span>
        <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">style_dict</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">patches</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Maximum Resident Set Size (MB)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels_mod</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Benchmark of different Hi-C mapping tools for 1 mln reads (5 iterations)&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.99</span><span class="p">)</span>

<span class="c1"># (x, y, width, height)</span>
<span class="n">bb</span> <span class="o">=</span> <span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">top</span><span class="o">+</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">right</span><span class="o">-</span><span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bb</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Number of cores&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">bbox_transform</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;benchmarking_1mln.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_benchmark_benchmark_69_0.png" src="../../_images/examples_benchmark_benchmark_69_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#FD7F69&#39;</span><span class="p">,</span> <span class="s1">&#39;#9FC9DD&#39;</span><span class="p">,</span> <span class="s1">&#39;#89A76F&#39;</span><span class="p">]</span>

<span class="n">style_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>
        <span class="n">palette</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">errwidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mf">0.07</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;util&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">),</span>
        <span class="n">order</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;ncores&#39;</span><span class="p">,</span>
        <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">style_dict</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">patches</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (sec)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels_mod</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">5e3</span><span class="p">])</span>
<span class="c1"># ax.set_xticks(np.arange(0, 5000, 100), minor=True)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;max_rss&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;util&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">),</span>
        <span class="n">order</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;ncores&#39;</span><span class="p">,</span>
        <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">style_dict</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">patches</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Maximum Resident Set Size (MB)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels_mod</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Benchmark of different Hi-C mapping tools for 1 mln reads (5 iterations)&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.99</span><span class="p">)</span>

<span class="c1"># (x, y, width, height)</span>
<span class="n">bb</span> <span class="o">=</span> <span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">top</span><span class="o">+</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">right</span><span class="o">-</span><span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bb</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Number of cores&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">bbox_transform</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;benchmarking_1mln_log.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_benchmark_benchmark_70_0.png" src="../../_images/examples_benchmark_benchmark_70_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[89]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;chromap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pairtools_bwamem2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tadbit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pairtools&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tadbit_bowtie2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;juicer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hicpro&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hicexplorer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fanc_bwa&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fanc_bowtie2&#39;</span><span class="p">,</span>
    <span class="c1"># &#39;bwamem2&#39;,</span>
    <span class="c1"># &#39;bwamem&#39;,</span>
    <span class="c1"># &#39;bowtie&#39;,</span>
<span class="p">]</span>
<span class="n">labels_mod</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Chromap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bwa-mem2 + pairtools&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GEM + TADbit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bwa mem + pairtools&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bowtie2 + TADbit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Juicer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Hi-Pro&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HiCExplorer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bwa mem + FANC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bowtie2 + FANC&#39;</span><span class="p">,</span>
    <span class="c1"># &#39;bwa-mem2&#39;,</span>
    <span class="c1"># &#39;bwa mem&#39;,</span>
    <span class="c1"># &#39;bowtie2&#39;,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[90]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">timings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;ncores&#39;</span><span class="p">,</span> <span class="s1">&#39;util&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;max_rss_gb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;max_rss&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">1024</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;s&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[91]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#FD7F69&#39;</span><span class="p">,</span> <span class="s1">&#39;#9FC9DD&#39;</span><span class="p">,</span> <span class="s1">&#39;#89A76F&#39;</span><span class="p">]</span>

<span class="n">style_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>
        <span class="n">palette</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">errwidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mf">0.07</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;util&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">),</span>
        <span class="n">order</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;ncores&#39;</span><span class="p">,</span>
        <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">style_dict</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">patches</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (sec)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels_mod</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1">#ax.set_xscale(&#39;log&#39;)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5e3</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>


<span class="c1"># Add text, slowdown over chromap</span>
<span class="n">ncores_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">icore</span><span class="p">,</span> <span class="n">ncores</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ncores_order</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ilabels</span><span class="p">,</span> <span class="n">util</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">util</span><span class="o">==</span><span class="s2">&quot;chromap&quot;</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">df_reference</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ncores==</span><span class="si">{</span><span class="n">ncores</span><span class="si">}</span><span class="s1"> and util==&quot;chromap&quot;&#39;</span><span class="p">)</span>
        <span class="n">mean_reference</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_reference</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">df_target</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ncores==</span><span class="si">{</span><span class="n">ncores</span><span class="si">}</span><span class="s1"> and util==&quot;</span><span class="si">{</span><span class="n">util</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">mean_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_target</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="n">slowdown</span> <span class="o">=</span> <span class="n">mean_target</span> <span class="o">/</span> <span class="n">mean_reference</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>

        <span class="n">b</span><span class="o">.</span><span class="n">text</span><span class="p">(</span> <span class="n">s</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;x </span><span class="si">{</span><span class="n">slowdown</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="n">mean_target</span><span class="o">+</span><span class="mi">150</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ilabels</span> <span class="o">+</span> <span class="p">(</span><span class="n">icore</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="p">,</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>



<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;max_rss&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;util&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">),</span>
        <span class="n">order</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;ncores&#39;</span><span class="p">,</span>
        <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">style_dict</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">patches</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Maximum Resident Set Size (MB)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels_mod</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Benchmark of different Hi-C mapping tools for 1 mln reads (5 iterations)&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.99</span><span class="p">)</span>

<span class="c1"># (x, y, width, height)</span>
<span class="n">bb</span> <span class="o">=</span> <span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">top</span><span class="o">+</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">right</span><span class="o">-</span><span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bb</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Number of cores&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">bbox_transform</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;benchmarking_1mln.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_benchmark_benchmark_73_0.png" src="../../_images/examples_benchmark_benchmark_73_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[92]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dct_mapper</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;bowtie&#39;</span><span class="p">:</span> <span class="s1">&#39;bowtie&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bwamem&#39;</span><span class="p">:</span> <span class="s1">&#39;bwamem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bwamem2&#39;</span><span class="p">:</span> <span class="s1">&#39;bwamem2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;chromap&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;fanc_bowtie2&#39;</span><span class="p">:</span> <span class="s1">&#39;bowtie&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fanc_bwa&#39;</span><span class="p">:</span> <span class="s1">&#39;bwamem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hicexplorer&#39;</span><span class="p">:</span> <span class="s1">&#39;bwamem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hicpro&#39;</span><span class="p">:</span><span class="s1">&#39;bowtie&#39;</span><span class="p">,</span>
    <span class="s1">&#39;juicer&#39;</span><span class="p">:</span> <span class="s1">&#39;bwamem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pairtools&#39;</span><span class="p">:</span> <span class="s1">&#39;bwamem&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pairtools_bwamem2&#39;</span><span class="p">:</span> <span class="s1">&#39;bwamem2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tadbit&#39;</span><span class="p">:</span> <span class="s1">&#39;GEM&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tadbit_bowtie2&#39;</span><span class="p">:</span> <span class="s1">&#39;bowtie&#39;</span>
<span class="p">}</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;mapper&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">dct_mapper</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[93]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mapper&#39;</span><span class="p">,</span> <span class="s1">&#39;ncores&#39;</span><span class="p">],</span> <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;util&#39;</span><span class="p">,</span> <span class="s1">&#39;ncores&#39;</span><span class="p">],</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;_mapper&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[94]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;pairtools_bwamem2&#39;</span><span class="p">,</span>
    <span class="c1"># &#39;tadbit&#39;,</span>
    <span class="s1">&#39;pairtools&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tadbit_bowtie2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;juicer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fanc_bwa&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hicexplorer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hicpro&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fanc_bowtie2&#39;</span><span class="p">,</span>
    <span class="c1"># &#39;bwamem2&#39;,</span>
    <span class="c1"># &#39;bwamem&#39;,</span>
    <span class="c1"># &#39;bowtie&#39;,</span>
<span class="p">]</span>
<span class="n">labels_mod</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;bwa-mem2 + pairtools&#39;</span><span class="p">,</span>
    <span class="c1"># &#39;GEM + TADbit&#39;,</span>
    <span class="s1">&#39;bwa mem + pairtools&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bowtie2 + TADbit&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Juicer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bwa mem + FANC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HiCExplorer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Hi-Pro&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bowtie2 + FANC&#39;</span><span class="p">,</span>
    <span class="c1"># &#39;bwa-mem2&#39;,</span>
    <span class="c1"># &#39;bwa mem&#39;,</span>
    <span class="c1"># &#39;bowtie2&#39;,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[113]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#FD7F69&#39;</span><span class="p">,</span> <span class="s1">&#39;#9FC9DD&#39;</span><span class="p">,</span> <span class="s1">&#39;#89A76F&#39;</span><span class="p">]</span>
<span class="n">style_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>
        <span class="n">palette</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">errwidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mf">0.07</span><span class="p">)</span>

<span class="n">cmap1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#ECECEC&#39;</span><span class="p">,</span> <span class="s1">&#39;#BFBFBF&#39;</span><span class="p">,</span> <span class="s1">&#39;#868686&#39;</span><span class="p">]</span>
<span class="n">style_dict1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span>
        <span class="n">palette</span><span class="o">=</span><span class="n">cmap1</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">errwidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>


<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;util&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">),</span>
        <span class="n">order</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;ncores&#39;</span><span class="p">,</span>
        <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">style_dict</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">patches</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


<span class="n">b1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;s_mapper&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;util&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">),</span>
        <span class="n">order</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;ncores&#39;</span><span class="p">,</span>
        <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">style_dict1</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b1</span><span class="o">.</span><span class="n">patches</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (sec)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels_mod</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1">#ax.set_xscale(&#39;log&#39;)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5e3</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6000</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>


<span class="c1"># Add text, runtime percentage out of mapper timing</span>
<span class="n">ncores_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">icore</span><span class="p">,</span> <span class="n">ncores</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ncores_order</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ilabels</span><span class="p">,</span> <span class="n">util</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">util</span><span class="o">==</span><span class="s2">&quot;chromap&quot;</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">df_target</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ncores==</span><span class="si">{</span><span class="n">ncores</span><span class="si">}</span><span class="s1"> and util==&quot;</span><span class="si">{</span><span class="n">util</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">mean_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_target</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">mean_mapper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_target</span><span class="p">[</span><span class="s1">&#39;min_mapper&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="n">prc</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">mean_mapper</span><span class="p">)</span> <span class="o">/</span> <span class="n">mean_target</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">prc</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">:</span>
            <span class="n">signature</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;~0 : ~100 %&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signature</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prc</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="mi">100</span><span class="o">-</span><span class="n">prc</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> %&quot;</span>

        <span class="n">b</span><span class="o">.</span><span class="n">text</span><span class="p">(</span> <span class="n">s</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="n">mean_target</span><span class="o">+</span><span class="mi">150</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ilabels</span> <span class="o">+</span> <span class="p">(</span><span class="n">icore</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="p">,</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>



<span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;max_rss&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;util&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">),</span>
        <span class="n">order</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;ncores&#39;</span><span class="p">,</span>
        <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">style_dict</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">patches</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


<span class="n">b1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;max_rss_mapper&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;util&quot;</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">),</span>
        <span class="n">order</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;ncores&#39;</span><span class="p">,</span>
        <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">style_dict1</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">b1</span><span class="o">.</span><span class="n">patches</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>



<span class="c1"># Add text, runtime percentage out of mapper timing</span>
<span class="n">ncores_order</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">icore</span><span class="p">,</span> <span class="n">ncores</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ncores_order</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">ilabels</span><span class="p">,</span> <span class="n">util</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">util</span><span class="o">==</span><span class="s2">&quot;chromap&quot;</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">df_target</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ncores==</span><span class="si">{</span><span class="n">ncores</span><span class="si">}</span><span class="s1"> and util==&quot;</span><span class="si">{</span><span class="n">util</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">mean_target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_target</span><span class="p">[</span><span class="s1">&#39;max_rss&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">mean_mapper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_target</span><span class="p">[</span><span class="s1">&#39;max_rss_mapper&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="n">prc</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">mean_mapper</span><span class="p">)</span> <span class="o">/</span> <span class="n">mean_target</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">prc</span><span class="o">&gt;=</span><span class="mi">100</span><span class="p">:</span>
            <span class="n">signature</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signature</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prc</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="mi">100</span><span class="o">-</span><span class="n">prc</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> %&quot;</span>

        <span class="n">b</span><span class="o">.</span><span class="n">text</span><span class="p">(</span> <span class="n">s</span><span class="o">=</span><span class="n">signature</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="n">mean_target</span><span class="o">+</span><span class="mi">550</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ilabels</span> <span class="o">+</span> <span class="p">(</span><span class="n">icore</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="p">,</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>



<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Maximum Resident Set Size (MB)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels_mod</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axisbelow</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># fig.suptitle(&#39;Benchmark of different Hi-C mapping tools for 1 mln reads (5 iterations)&#39;, y=0.99)</span>

<span class="c1"># (x, y, width, height)</span>
<span class="n">bb</span> <span class="o">=</span> <span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">top</span><span class="o">+</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">right</span><span class="o">-</span><span class="n">fig</span><span class="o">.</span><span class="n">subplotpars</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="c1"># ax.legend(bbox_to_anchor=bb, title=&quot;Number of cores&quot;, loc=&quot;lower right&quot;, ncol=3, borderaxespad=0., bbox_transform=fig.transFigure, frameon=False)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;benchmarking_1mln.mappers.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_benchmark_benchmark_77_0.png" src="../../_images/examples_benchmark_benchmark_77_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Ivan Ilnitskiy.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>